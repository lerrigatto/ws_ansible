---
- name: "Install yadm"
  apt:
    pkg:
      - yadm
    state: present
    install_recommends: no
  become: yes
  when: ansible_facts['os_family'] == "Debian"


- name: "install yadm"
  community.general.homebrew:
    name:
      - yadm
    state: latest
    update_homebrew: yes
  when: ansible_facts['os_family'] == "Darwin"

- name: "Yadm clone"
  command: "yadm clone -f {{ yadm_repo_url }}"

- name: "Yadm hard reset"
  command: "yadm reset --hard origin/{{ yadm_remote_branch }}"
  register: yadm_reset_output
  failed_when: "yadm_reset_output.stderr"
